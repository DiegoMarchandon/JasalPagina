"use strict";(()=>{var e={};e.id=12,e.ids=[12],e.modules={666:e=>{e.exports=require("cookie")},829:e=>{e.exports=require("jsonwebtoken")},3480:(e,r,t)=>{e.exports=t(5600)},4900:(e,r,t)=>{t.d(r,{A:()=>a});let a=require("mysql2/promise").createPool({host:process.env.DB_HOST,user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME,waitForConnections:!0,connectionLimit:10,queueLimit:0})},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},9564:(e,r,t)=>{t.r(r),t.d(r,{config:()=>y,default:()=>P,routeModule:()=>m});var a={};t.r(a),t.d(a,{createUsuario:()=>f,default:()=>A,deleteUsuario:()=>p,getAllUsuarios:()=>l,getUsuarioById:()=>d,updateUsuario:()=>E});var o=t(3480),s=t(8667),i=t(6435),u=t(4900),n=t(666),c=t(829);async function l(){let e;try{e=await u.A.getConnection();let[r]=await e.query("SELECT * FROM usuario;");return r}catch(e){throw Error("getAllUsuarios error al obtener los usuarios: "+e.message)}finally{e&&e.release()}}async function d(e){let r;try{r=await u.A.getConnection();let[t]=await r.execute("SELECT * FROM usuario WHERE idusuario = ?"+[e]);return t}catch(e){throw Error("getUsuarioById error al obtener al usuario: "+e.message)}finally{r&&r.release()}}async function f(e){let r;try{r=await u.A.getConnection();var t=[e.usmail,e.usnombre,e.uspass];let[a]=await r.execute("INSERT INTO usuario (usmail,usnombre,uspass) VALUES (?,?,?);",t);return a.insertId}catch(e){throw Error("createUsuario error al crear usuario: "+e.message)}finally{r&&r.release()}}async function E(e,r){let t;try{t=await u.A.getConnection();var a="UPDATE usuario SET ",o=[],s=0;for(let[e,t]of Object.entries(r))void 0!==t&&(++s>1&&(a+=", "),a+=`${e} = ?`,o.push(t));o.push(e),a+=" WHERE idusuario = ? ;";let[i]=await t.execute(a,o);return i.affectedRows}catch(e){throw Error("updateUsuario error al actualizar usuario: "+e.message)}finally{t&&t.release()}}async function p(e){let r;try{r=await u.A.getConnection();let[t]=await r.execute("UPDATE usuario SET ushabilitado = 0 WHERE idusuario = ?",[e]);return t.affectedRows}catch(e){throw Error("deleteUsuario error al eliminar usuario: "+e.message)}finally{r&&r.release()}}function A(e,r){let t=(e.headers.cookie?(0,n.parse)(e.headers.cookie):{}).token;if(!t)return r.status(401).json({error:"No autenticado"});try{let e=c.verify(t,process.env.JWT_SECRET);return r.status(200).json({usuario:e})}catch(e){return r.status(401).json({error:"Token inv\xe1lido o expirado"})}}let P=(0,i.M)(a,"default"),y=(0,i.M)(a,"config"),m=new o.PagesAPIRouteModule({definition:{kind:s.A.PAGES_API,page:"/api/requests/usuario",pathname:"/api/requests/usuario",bundlePath:"",filename:""},userland:a})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=9564);module.exports=t})();